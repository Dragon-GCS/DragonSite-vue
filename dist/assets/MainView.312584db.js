import{h as ee,i as k,c as L,j as U,k as ue,l as te,m as le,n as ae,o as re,d as s}from"./element-plus.a0c6cafa.js";import{z as N,r as D,o as x,c as R,a as f,H as E,I as F,Q as i,S as j,O as c,a5 as M,K as z,a8 as V,u as B,M as P}from"./@vue.fb846be3.js";import{b as H,u as oe}from"./vue-router.0e56c6e7.js";import{p as ne,i as l,l as se,g as ie,c as ce,r as T,a as I,d as pe,b as de}from"./index.80cd21ce.js";import"./@vueuse.048c5a89.js";import"./lodash-es.dd08ea16.js";import"./async-validator.fb49d0f5.js";import"./@element-plus.2111aa6d.js";import"./@popperjs.36402333.js";import"./@ctrl.82a509e0.js";import"./axios.5bc38a7d.js";import"./qs.3fd877a9.js";import"./side-channel.70f74c3b.js";import"./get-intrinsic.89e72507.js";import"./has-symbols.caae0f97.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.b701f999.js";import"./object-inspect.186a03c9.js";const me={class:"check-box"},fe=["src","alt"],ve=M("\u5220\u9664"),ge=M("\u91CD\u547D\u540D"),he=N({__name:"Item",props:["data","selectedArray","idx"],emits:["select","remove","rename","preview"],setup(r,{emit:u}){const a=r,v=H(),y=D(!1),p=D("");a.data.is_dir?p.value="/static/folder.png":a.data.category==="image"?ne(a.data.path,v.query.logRequire==="true").then(g=>{let n=window.URL.createObjectURL(new Blob([g]));p.value=n}):p.value=`/static/${a.data.category}.png`;const q=()=>a.data.name.length>12?a.data.name.slice(0,6)+"..."+a.data.name.slice(-3):a.data.name,d=()=>{k.confirm(`\u786E\u5B9A\u5220\u9664${a.data.name}?`,"\u786E\u8BA4\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{u("remove",a.data)}).catch(()=>{console.log("\u53D6\u6D88\u5220\u9664")})},o=()=>{k.prompt("\u8BF7\u8F93\u5165\u65B0\u7684\u6587\u4EF6\u540D","\u91CD\u547D\u540D",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",inputPattern:/^[\w\-. ]+$/,inputErrorMessage:"\u6587\u4EF6\u540D\u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u7A7A\u683C\u3001\u4E0B\u5212\u7EBF\u3001\u4E2D\u5212\u7EBF\u548C\u70B9"}).then(({value:g})=>{!g||u("rename",a.data,g)}).catch(g=>{console.log("\u53D6\u6D88\u91CD\u547D\u540D",g)})};return(g,n)=>{const C=ee,b=L,$=U;return x(),R("div",{class:"item-box",onMouseenter:n[3]||(n[3]=_=>y.value=!0),onMouseleave:n[4]||(n[4]=_=>y.value=!1)},[f("div",me,[E(i(C,{onChange:n[0]||(n[0]=_=>u("select",r.idx)),modelValue:r.selectedArray[r.idx],"onUpdate:modelValue":n[1]||(n[1]=_=>r.selectedArray[r.idx]=_)},null,8,["modelValue"]),[[F,y.value||r.selectedArray[r.idx]]])]),f("div",{onClick:n[2]||(n[2]=_=>u("preview",r.idx)),class:"click-block"},[f("p",null,[f("img",{src:p.value,alt:r.data.name,width:"64",height:"64"},null,8,fe)]),f("p",null,j(q()),1)]),E(i($,{style:{margin:"5px 0px"}},{default:c(()=>[i(b,{type:"info",size:"small",onClick:d},{default:c(()=>[ve]),_:1}),i(b,{type:"info",size:"small",onClick:o},{default:c(()=>[ge]),_:1})]),_:1},512),[[F,y.value]])],32)}}});function _e(r){if(r=="/")return[["Home",r]];for(var u=[["Home",""]],a=r.split("/"),v=1;v<a.length;v++)u.push([a[v],u[v-1][1]+"/"+a[v]]);return u[0][1]="/",u}const ye=f("i",{class:"i-ic-baseline-file-upload",style:{"font-size":"20px"}},null,-1),xe={style:{display:"flex","flex-wrap":"wrap"}},Le=N({__name:"MainView",emits:["pointerenter","pointerleave"],setup(r){const u=H(),a=oe(),v=_e((u.query.path||"/").toString()),y=`/api/disk/upload?login_require=${u.query.logRequire}&path=${u.query.path}`,p=D(!1),q=D(0);let d=D([]);l.value=[],se((u.query.path||"/").toString(),u.query.logRequire==="true",(u.query.filter||"all").toString()).then(e=>{l.value=e.data;for(let t=0;t<l.value.length;t++)d.value.push(!1);console.log("load resource",e)});const o=D([]),g=e=>{d.value[e]?o.value.push(l.value[e]):o.value=o.value.filter(t=>t.name!==l.value[e].name)},n=()=>{if(o.value.length===l.value.length){o.value=[];for(let e=0;e<d.value.length;e++)d.value[e]=!1}else{for(let e=0;e<d.value.length;e++)d.value[e]=!0;o.value=l.value}},C=e=>{let t=l.value[e];l.value=l.value.filter(m=>I.includes(m.category)),e=l.value.findIndex(m=>m.path===t.path),t.is_dir?a.push({name:"main",query:{idx:e,logRequire:u.query.logRequire,filter:u.query.filter}}):I.includes(t.category)?a.push({name:"preview",query:{idx:e,logRequire:u.query.logRequire}}):pe(t.name,t.path,u.query.logRequire==="true")},b=()=>{k.prompt("\u8BF7\u8F93\u5165\u6587\u4EF6\u5939\u540D\u79F0","\u65B0\u5EFA\u6587\u4EF6\u5939",{inputPattern:/^[a-zA-Z0-9_]+$/,inputErrorMessage:"\u6587\u4EF6\u5939\u540D\u79F0\u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u3001\u6570\u5B57\u548C\u4E0B\u5212\u7EBF"}).then(({value:e})=>{if(!!e){if(l.value.filter(t=>t.name===e).length!=0){s.error("\u6587\u4EF6\u5939\u5DF2\u5B58\u5728");return}ce((u.query.path||"/").toString(),e,u.query.logRequire==="true").then(t=>{l.value=l.value.concat(t),l.value.sort(),s.success("\u6587\u4EF6\u5939\u521B\u5EFA\u6210\u529F")})}}).catch(e=>{s.info("\u53D6\u6D88\u65B0\u5EFA\u6587\u4EF6\u5939")})},$=(e,t)=>{let w=(e.parent_path==="/"?"":e.parent_path)+"/"+t;if(l.value.filter(h=>h.path===w&&h.is_dir===e.is_dir).length!=0){s.error("\u540D\u79F0\u5DF2\u5B58\u5728");return}de(e.path,w,e.is_dir,u.query.logRequire==="true").then(h=>{let S=l.value.indexOf(e);l.value[S]=h[0],s.success("\u91CD\u547D\u540D\u6210\u529F")})},_=e=>{T((u.query.path||"/").toString(),[e.name],[e.is_dir],u.query.logRequire==="true").then(t=>{if(t.status!==200||!t.data.success){s.error("\u5220\u9664\u5931\u8D25");return}l.value=l.value.filter(m=>m!==e),d.value.fill(!1),console.log("remove resource",t),s.success("\u5220\u9664\u6210\u529F")})},O=async()=>{k.confirm(`\u786E\u5B9A\u5220\u9664\u9009\u4E2D\u7684${o.value.length}\u4E2A\u8D44\u6E90?`,"\u786E\u8BA4\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{T((u.query.path||"/").toString(),o.value.map(e=>e.name),o.value.map(e=>e.is_dir),u.query.logRequire==="true").then(e=>{if(e.status!==200||!e.data.success){s.error("\u5220\u9664\u5931\u8D25");return}l.value=l.value.filter(t=>!o.value.includes(t)),o.value=[],d.value.fill(!1),s.success("\u5220\u9664\u6210\u529F")})}).catch(()=>{console.log("\u53D6\u6D88\u5220\u9664")})},G=e=>l.value.filter(t=>t.name===e.name).length!==0?(s.error(`\u6587\u4EF6${e.name}\u5DF2\u5B58\u5728`),!1):(p.value||(p.value=!0),!0),K=(e,t,m)=>{l.value=l.value.concat(e),l.value.sort(),s.success(`${e[0].name}\u4E0A\u4F20\u6210\u529F`)},Q=(e,t,m)=>{e.status===401&&(s.error("\u672A\u767B\u5F55"),a.push({name:"login",query:{redirect:u.fullPath}})),p.value=!1,console.log("\u4E0A\u4F20\u5931\u8D25",e),s.error("\u4E0A\u4F20\u5931\u8D25")},Z=(e,t,m)=>{q.value=Math.round(e.percent),e.percent===100&&(p.value=!1)};return(e,t)=>{const m=ue,w=te,h=L,S=le,J=U,W=ae,X=he;return x(),R(z,null,[i(W,{class:"func-bar"},{default:c(()=>[i(w,null,{default:c(()=>[(x(!0),R(z,null,V(B(v),A=>(x(),P(m,{to:{name:"main",query:{path:A[1],logRequire:e.$route.query.logRequire,filter:e.$route.query.filter}}},{default:c(()=>[M(j(A[0]),1)]),_:2},1032,["to"]))),256))]),_:1}),i(J,null,{default:c(()=>[i(h,{type:"primary"},{default:c(()=>[f("i",{class:"i-ic-outline-create-new-folder",style:{"font-size":"20px"},onClick:b})]),_:1}),i(h,{type:"primary"},{default:c(()=>[f("i",{class:"i-fluent-select-all-on-24-filled",style:{"font-size":"20px"},onClick:n})]),_:1}),E(i(h,{type:"primary"},{default:c(()=>[f("i",{class:"i-ph-trash-fill",style:{"font-size":"20px"},onClick:O})]),_:1},512),[[F,o.value.length!==0]]),i(h,{type:"primary"},{default:c(()=>[E(i(B(re),{style:{display:"flex"},action:y,multiple:!0,headers:B(ie)(),name:"files","before-upload":G,"on-success":K,"on-error":Q,"on-progress":Z,"show-file-list":!1,"with-credentials":!0},{default:c(()=>[ye]),_:1},8,["headers"]),[[F,!p.value]]),E(i(S,{percentage:q.value,"stroke-width":2,type:"circle",width:20,status:"success"},null,8,["percentage"]),[[F,p.value]])]),_:1})]),_:1})]),_:1}),f("div",xe,[(x(!0),R(z,null,V(B(l),(A,Y)=>(x(),P(X,{data:A,idx:Y,selectedArray:B(d),onSelect:g,onRemove:_,onRename:$,onPreview:C},null,8,["data","idx","selectedArray"]))),256))])],64)}}});export{Le as default};
